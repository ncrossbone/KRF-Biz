<?xml version="1.0" encoding="UTF-8" ?>
<!--
       Copyright 2015-2016 the original author or authors.
       Licensed under the Apache License, Version 2.0 (the "License");
       you may not use this file except in compliance with the License.
       You may obtain a copy of the License at
          http://www.apache.org/licenses/LICENSE-2.0
       Unless required by applicable law or agreed to in writing, software
       distributed under the License is distributed on an "AS IS" BASIS,
       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
       See the License for the specific language governing permissions and
       limitations under the License.
-->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ce.krf.biz.mapper.ChartMapper">
    <select id="getRWMDT" resultType="hashmap">
    	SELECT /* KRF-BIZ.ChartMapper.getRWMDT */
               COL_KOR AS "column",
       		   CONT  AS "cont"
    	  FROM KRF_SITEINFO 
    	  WHERE SITE_CD = #{recordId}
    	  <if test="parentId != null and  (parentId eq 'I'.toString())">
    	  AND GUBUN = #{parentId}
    	  </if>
    </select>
    
    <select id="getInfo_Q" resultType="hashmap">
    	SELECT /* KRF-BIZ.ChartMapper.getInfo_Q */
    		   DECODE(ROWNUM,1,SWGDSPT_NM ,2,FCLTY_CPCTY ,3,DE_AVRG_INFLOW_QY,4,FYER_INFLOW_QY,5,DE_AVRG_PHYTRMT_QY,6,DE_AVRG_BIOTRMT_QY,
			   7,DE_AVRG_ADVTRMT_QY,8,FYER_WASTTRMT_QY,9,OPR_PREARNGE_DE,10,PROCESS_ZONE,11,PROCESS_MTH,12,DCWTR_WATERS) AS "cont",
			   DECODE(ROWNUM,1,'시설명' ,2,'시설용량' ,3,'하수유입량-일평균',4,'하수유입량-연간',5,'하수처리량-일평균-물리적',6,'하수처리량-일평균-생물학적',
			   7,'하수처리량-일평균-고도',8,'하수처리량-연간',9,'가동예정일',10,'처리구역',11,'처리방법',12,'방류수역') AS "column"
		  FROM ( SELECT SWGDSPT_NM,
						FCLTY_CPCTY,
						DE_AVRG_INFLOW_QY,
						FYER_INFLOW_QY,
						DE_AVRG_PHYTRMT_QY,
						DE_AVRG_BIOTRMT_QY,
						DE_AVRG_ADVTRMT_QY,
						FYER_WASTTRMT_QY,
						OPR_PREARNGE_DE,
						PROCESS_ZONE,
						PROCESS_MTH,
						DCWTR_WATERS    
 				   FROM FCL_SWGDSPT
				  WHERE SWGDSPT_CODE = #{recordId})
	CONNECT BY LEVEL <![CDATA[<=]]> 12
    </select>
    
    <select id="getRWMDTSelectQ" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
    SELECT /* KRF-BIZ.ChartMapper.getRWMDTSelectQ */ 
    	   PT_NO,
    	   ITEM_VALUE,
    	   ITEM_NAME,
    	   MESURE_DT,
    	   WMCYMD
  	  FROM ( SELECT SWGDSPT_CODE AS PT_NO,
       			    ${selectItem} AS ITEM_VALUE,
       				#{selectItem} AS ITEM_NAME,
       				MESURE_DE AS MESURE_DT,
       				SUBSTR(MESURE_DE,0,4) || '.' || SUBSTR(MESURE_DE,5,2)|| '.' || SUBSTR(MESURE_DE,7,2) AS WMCYMD
  			  FROM MSR_SWGDSPT_INFLOW_DAY
			 WHERE SWGDSPT_CODE =  #{recordId}
		  ORDER BY MESURE_DE DESC
			)
	<if test="defaultChart != null and defaultChart == 1">
		WHERE <![CDATA[ ROWNUM <= 5]]>
  	</if>
	<if test="defaultChart != null and defaultChart == 0">
   		WHERE MESURE_DT BETWEEN #{preFullDate} || '00' AND #{nextFullDate} || '31'
	</if>
 UNION ALL
		 SELECT '' AS PT_NO,
    			MAX(${selectItem}) AS ITEM_VALUE,
    			'' AS ITEM_NAME,
    			'9999' AS MESURE_DT,
    			'' AS WMCYMD
		   FROM MSR_SWGDSPT_INFLOW_DAY
           ORDER BY MESURE_DT
    </select>
    
    <select id="getRWMDTSelectM001" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
    	SELECT /* KRF-BIZ.ChartMapper.getRWMDTSelect2018M001 */ PT_NO,
    	       ITEM_VALUE,
    	       ITEM_NAME,
    	       MESURE_DT,
    	       WMCYMD
  		  FROM ( SELECT NPMN_CODE AS PT_NO,
    					${selectItem} AS ITEM_VALUE,
    					#{selectItem} AS ITEM_NAME,
    					MESURE_DT,
    					SUBSTR(MESURE_DT,0,4) || '.' || SUBSTR(MESURE_DT,5,2) || '.' || SUBSTR(MESURE_DT,7,2) || ' ' || SUBSTR(MESURE_DT,9,2) || '시' AS WMCYMD
				   FROM MSR_NPMN_ATMC
				  WHERE NPMN_CODE = #{recordId}
			   ORDER BY MESURE_DT DESC
			    )
          <if test="defaultChart != null and defaultChart == 1">
   		       	  WHERE <![CDATA[ ROWNUM <= 10]]>
  		  </if>
  		   <if test="defaultChart != null and defaultChart == 0">
   		       	  WHERE MESURE_DT BETWEEN #{preFullDate} || '000000' AND #{nextFullDate} || '235959'
		  </if>
	  UNION ALL
		 SELECT '' AS PT_NO,
    			MAX(${selectItem}) AS ITEM_VALUE,
    			'' AS ITEM_NAME,
    			'9999' AS MESURE_DT,
    			'' AS WMCYMD
		   FROM MSR_NPMN_ATMC
       ORDER BY MESURE_DT
    </select>
    
    <select id="getRWMDTSelectM002" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
    	     SELECT /* KRF-BIZ.ChartMapper.getRWMDTSelect2018M002 */ PT_NO,
    	       ITEM_VALUE,
    	       ITEM_NAME,
    	       MESURE_DE,
    	       WMCYMD
  		  FROM (
       SELECT NPMN_CODE AS PT_NO,
    					${selectItem} AS ITEM_VALUE,
    					#{selectItem} AS ITEM_NAME,
    					MESURE_DE,
    					MESURE_DE || ' ' || NO || '회차(' || ODR || ')' AS WMCYMD
				   FROM MSR_NPMN_PASSIV
                    ORDER BY MESURE_DE DESC, WMCYMD
			    )
			    <if test="defaultChart != null and defaultChart == 1">
   		       	  WHERE <![CDATA[ ROWNUM <= 10]]>
  		  </if>
  		   <if test="defaultChart != null and defaultChart == 0">
   		       	  WHERE MESURE_DE BETWEEN #{preFullDate} AND #{nextFullDate}
		  </if>
              UNION ALL
                  SELECT '' AS PT_NO,
                         MAX(${selectItem}) AS ITEM_VALUE,
                        '' AS ITEM_NAME,
    			'9999' AS MESURE_DE,
    			'' AS WMCYMD
		   FROM MSR_NPMN_PASSIV
           ORDER BY MESURE_DE, WMCYMD
      </select>
      
      <select id="getRWMDTSelect2018L" resultType="hashmap">
      
      	SELECT RN,
		       PT_NO,
		       PT_NM,
		       WMCYMD,
		       ITEM_NAME,
		       ITEM_VALUE
		  FROM V_EXM_ENVBSIS_GIS_CHART
      
      </select>
      
    <insert id="insertChartPram" parameterType="com.ce.krf.biz.model.ChartVO">
    	INSERT
		  INTO COM_VRIABL_TMPR(VRIABL_1_VALUE, VRIABL_2_VALUE, VRIABL_3_VALUE, VRIABL_4_VALUE)
		VALUES(#{recordId},
               #{selectItem}, 
               #{preFullDate},
               #{nextFullDate})
    </insert>
    
    <select id="getRWMDTSelect2018A" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
    	SELECT RN,
		       WMYR,
		       WMOD,
		       WMWK,
		       PT_NO,
		       PT_NM,
		       WMCYMD,
		       ITEM_NAME,
		       ITEM_VALUE,
		       ITEM_VALUE_1
		  FROM V_MSR_WQMN_DAY_DCSN_GIS_CHART
    </select>
        
    <select id="getRWMDTSelectA" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	     WITH TMP_TBL AS (
	    	SELECT /* KRF-BIZ.ChartMapper.getRWMDTSelectA */
	    		   RANK( ) OVER(PARTITION BY A.PT_NO||ITEM_NAME
	        	   ORDER BY WMCYMD DESC) RN ,
			       A.PT_NO,
			       PT_NM,
			       A.WMYR,
			       A.WMOD,
			       WMWK,
			       WMCYMD,
			       ITEM_NAME ,
	          CASE
	               WHEN SUBSTR(ITEM_VALUE, 1, 1) = '.' THEN 0||ITEM_VALUE
	               ELSE ITEM_VALUE
	               END ITEM_VALUE
	          FROM (
	        			SELECT PT_NO,
	          				   WMYR,
	                           WMOD,
	                           WMCD ,
	                      CASE
			                   WHEN ITCD = '1052' THEN 'ITEM_BOD'
			                   WHEN ITCD = '1054' THEN 'ITEM_DOC'
			                   WHEN ITCD = '1049' THEN 'ITEM_COD'
			                   WHEN ITCD = '1055' THEN 'ITEM_TN'
			                   WHEN ITCD = '1056' THEN 'ITEM_TP'
			                   WHEN ITCD = '1060' THEN 'ITEM_TEMP'
			                   WHEN ITCD = '1039' THEN 'ITEM_PH'
			                   WHEN ITCD = '1053' THEN 'ITEM_SS'
			                   WHEN ITCD = '1063' THEN 'ITEM_CLOA'
	                  	   END ITEM_NAME ,
	                           TO_CHAR(WMVL) AS ITEM_VALUE ,
	          				   TO_CHAR(WMVL) AS ITEM_VALUE_1
	                      FROM TW_RWMDT
	                     WHERE ITCD IN ('1052',
	                                    '1054',
						                '1049',
						                '1055',
						                '1056',
						                '1060',
						                '1039',
						                '1053',
						                '1063') 
			        ) A ,
	            RWMPT B ,
	               (
	        		    SELECT DISTINCT PT_NO ,
					           WMYR ,
					           WMOD ,
					           SUBSTR(WMWK, 1, 1)||'회차' AS WMWK ,
					           WMCYMD
	                      FROM RWMDTD 
	               ) C
					     WHERE A.PT_NO = B.PT_NO
					       AND A.PT_NO = C.PT_NO
					       AND A.WMYR = C.WMYR
					       AND A.WMOD = C.WMOD
					       AND A.WMCD = SUBSTR(C.WMWK, 1, 1)
					       AND C.WMCYMD IS NOT NULL
					       AND A.PT_NO = #{recordId}
					       <if test="defaultChart != null and defaultChart == 0">
   		       	   			   AND A.WMYR||A.WMOD BETWEEN #{preFullDate} AND #{nextFullDate} 
  			   			   </if>
					       AND ITEM_NAME = #{selectItem}
					       AND ITEM_VALUE IS NOT NULL
					  ORDER BY WMCYMD, ITEM_NAME
					)
	SELECT RN,
	       PT_NO,
	       PT_NM,
	       WMYR,
	       WMOD,
	  	   WMWK,
	       WMCYMD,
	       ITEM_NAME,
	       TO_NUMBER(ITEM_VALUE) AS ITEM_VALUE ,
	       REPLACE(ITEM_VALUE, '999999999', '정량한계미만' ) AS ITEM_VALUE_1
	  FROM (
	          SELECT *
	            FROM TMP_TBL
	 		   <if test="defaultChart != null and defaultChart == 1">
   		       	   WHERE <![CDATA[ RN <= 10 ]]> 
  			   </if>
	        ORDER BY WMCYMD
	       )
	UNION ALL
	SELECT 999 as RN,
	  '',
	  '',
	  '',
	  '',
	  '',
	  '',
	  '',
	  MAX(TO_NUMBER(REPLACE(TO_NUMBER(ITEM_VALUE), 999999999, 0))) + MAX(TO_NUMBER(REPLACE(TO_NUMBER(ITEM_VALUE), 999999999, 0))) / 10,
	  ''
	FROM TMP_TBL
	<if test="defaultChart != null and defaultChart == 1">
   		WHERE <![CDATA[ RN <= 10 ]]> 
  	</if>
   
    
    </select>
    
    <select id="getRWMDTSelect2018B" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
    
	    SELECT RN,
		       PT_NO,
		       DCWTRH_NO,
		       PT_NM,
		       WMCYMD,
		       ITEM_NAME,
		       ITEM_VALUE
		  FROM V_ANL_TMS_DAYAVG_GIS_CHART
    
    </select>
    
    <select id="getRWMDTSelectB" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	     WITH TMP_TBL AS (
	     					/* KRF-BIZ.ChartMapper.getRWMDTSelectB */
    						SELECT RANK() OVER(PARTITION BY FACT_CODE||WAST_NO||ITEM_NAME
        						   ORDER BY BASE_TIME DESC) RN,
      						       FACT_CODE AS PT_NO ,
 								   /* 사업장코드 */FACT_NAME AS PT_NM ,
 								   /* 사업장명 */WAST_NO ,
 								   /* 방류구번호 */SUBSTR(BASE_TIME, 1, 4)||'.'||SUBSTR(BASE_TIME, 5, 2)||'.'||SUBSTR(BASE_TIME, 7, 2) AS WMCYMD ,
 								   /* 측정일자 */ITEM_NAME,
        						   TO_NUMBER(ITEM_VALUE) AS ITEM_VALUE
                              FROM (
        								SELECT DISTINCT A.ADM_CD,
          									   A.BASE_TIME,
          									   A.WAST_NO,
          									   A.FACT_CODE,
          									   A.FACT_NAME,
                                          CASE
							                   WHEN A.ITEM_CODE = 'BOD00' THEN 'ITEM_BOD'
							                   WHEN A.ITEM_CODE = 'COD00' THEN 'ITEM_COD'
							                   WHEN A.ITEM_CODE = 'SUS00' THEN 'ITEM_SS'
							                   WHEN A.ITEM_CODE = 'TON00' THEN 'ITEM_TN'
							                   WHEN A.ITEM_CODE = 'TOP00' THEN 'ITEM_TP'
							                   WHEN A.ITEM_CODE = 'PHY00' THEN 'ITEM_PH'
							                   WHEN A.ITEM_CODE = 'FLW01' THEN 'ITEM_FLW'
							                   WHEN A.ITEM_CODE = 'TOC00' THEN 'ITEM_TOC'
                    					  ELSE NULL
                  						   END ITEM_NAME,
          									   A.HOUR_VL AS ITEM_VALUE,
                                               A.FACT_KIND,
                                               A.FACT_KIND_NAME,
                                               A.FACT_CAPACITY
        								  FROM (
            										SELECT A.FACT_CODE,
											               A.BASE_TIME,
											               A.WAST_NO,
											               A.ITEM_CODE,
                           							  CASE UPPER(A. HOUR_VL)
                            						  WHEN 'NULL' THEN NULL
                            						  ELSE A.HOUR_VL
                          							   END HOUR_VL ,
              											   A.TRANS_TIME,
              											   B.FACT_NAME,
											               B.ADM_CD,
											               C.FACT_KIND,
											               F.FACT_KIND_NAME,
											               TO_NUMBER( C.FACT_CAPACITY) FACT_CAPACITY,
											               C.FACT_BUSINESS,
											               D.RIVER_CODE ,
											               E.NAME RIVER_NAME
											          FROM TMS_HOURDATA A,
											               WTMSC_FACT_WAST_TEMP B,
											               WTMSC_FACT C,
											               WTMSC_FACT_WAST D,
											               WTMSC_RIVER E,
											               WTMSC_FACT_KIND F
            										 WHERE A.FACT_CODE = B.FACT_CODE
										               AND A.WAST_NO = B.WAST_NO
										               AND A.FACT_CODE = C.FACT_CODE
										               AND A.FACT_CODE = D.FACT_CODE
										               AND A.WAST_NO = D.WAST_NO
										               AND D.WAST_USED = 'Y'
										               AND D.RIVER_CODE = E.CODE(+)
										               AND C.FACT_KIND = F.FACT_KIND(+) 
										         ) A,
                                    (
							            SELECT DISTINCT A.ITEM_ORDER,
							                   A.ITEM_CODE,
								               A.ITEM_NAME,
								               A .ITEM_MNAME,
								               A.ITEM_UNIT_CODE ,
								               A.COL_NAME,
								               A.TWTMS_CODE,
								               A.ITEM_USED,
								               A.LEVY_FLAG,
								               A.EX_LEVY_FLAG,
								               A.ITEM_DP,
								               A.MEAS_KIND_CODE,
								               A.ITEM_KIND_CODE,
								               A.MEAS_KIND_CODE_SECOND,
								               A.ITEM_DP2,
								               B.ITEM_UNIT
							             FROM WTMSC_ITEM A,
							                  WTMSC_CODE B
							            WHERE A.ITEM_UNIT_CODE = B.ITEM_UNIT_CODE
							              AND A.ITEM_USED = 'Y' 
							        ) B
						WHERE A.ITEM_CODE = B.ITEM_CODE 
					)
		    WHERE 1=1
				<if test="defaultChart != null and defaultChart == 0">
					 <![CDATA[ AND SUBSTR(BASE_TIME, 1, 6) >= #{preFullDate} ]]>
					 <![CDATA[ AND SUBSTR(BASE_TIME, 1, 6) <= #{nextFullDate} ]]>
				</if>
		      AND FACT_CODE = #{recordId}
		      AND ITEM_NAME = #{selectItem}
		      AND ITEM_VALUE IS NOT NULL
		    ORDER BY ROWNUM DESC 
		   )
SELECT RN,
	   PT_NO,
	   PT_NM,
	   WAST_NO,
	   WMCYMD,
	   ITEM_NAME,
	   ITEM_VALUE
 FROM (
    SELECT *
      FROM TMP_TBL
     <if test="defaultChart != null and defaultChart == 1">
   		 WHERE <![CDATA[ RN <= 10 ]]> 
  	 </if>    
  ORDER BY ROWNUM DESC 
    )
UNION ALL
   SELECT 9999 AS RN,
          '',
		  '',
		  '',
		  '',
		  '',
		  MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10
	 FROM TMP_TBL 
    </select>
    
    <select id="getRWMDTSelectC" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
     WITH TMP_TBL
        AS (
    SELECT RANK ()
            OVER (PARTITION BY PT_NO
                  ORDER BY WMYR||WMOM||WMOD DESC)
            RN
        , VGBN, RAGBN, PT_NO, PT_NM	
        , WMYR
        , DECODE(WMWK,'1','상반기','2','하반기') AS WMWK
        , WMOM, WMOD, WMCTM 
        , MCNT
        , '${selectItem}' AS ITEM_NAME
        , ${selectItem} AS ITEM_VALUE
          FROM (		
                SELECT * FROM(		
                        SELECT V.* 	
                          FROM CE_SDM_RWMDTI_DAY_DAE_V V	
                        WHERE V.VGBN='S'
                        AND V.PT_NO = #{recordId} 
                        <if test="defaultChart != null and defaultChart == 0">
                        	AND V.WMYRWK BETWEEN #{preFullDate} AND #{nextFullDate} 
                        </if>
                             )                                                                         
                 ORDER BY WMYR, WMWK, ORD_PT_NM, ORD_GBN 
               )      ORDER BY WMYR ASC ,WMWK ASC
          )
SELECT RN, PT_NO, PT_NM, TO_CHAR(WMYR) AS WMYR, WMWK AS WMWK, WMYR||' '||WMWK AS WMCYMD, ITEM_NAME
     , TO_CHAR(REPLACE (ITEM_VALUE, '정량한계미만',999999999)) AS ITEM_VALUE, TO_CHAR(ITEM_VALUE) AS ITEM_VALUE_1
  FROM TMP_TBL
 <if test="defaultChart != null and defaultChart == 1">
	WHERE  <![CDATA[ RN <= 10 ]]>
 </if> 
UNION ALL
SELECT 999 AS RN,
       '',
       '',
       '',
       '',
       '',
       '',
       CASE WHEN SUBSTR(TO_CHAR(MAX (TO_NUMBER (REPLACE (TRIM(ITEM_VALUE), '정량한계미만',0)))*1.1),1,1) = '.' THEN '0'||TO_CHAR(MAX (TO_NUMBER (REPLACE (TRIM(ITEM_VALUE), '정량한계미만',0)))*1.1)
       ELSE TO_CHAR(MAX (TO_NUMBER (REPLACE (TRIM(ITEM_VALUE), '정량한계미만',0)))*1.1)
       END,
       ''
  FROM TMP_TBL
 <if test="defaultChart != null and defaultChart == 1">
	WHERE  <![CDATA[ RN <= 10 ]]>
 </if>
    </select>
    
	<select id="getRWMDTSelectD001" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectD001 */
	     AS (SELECT * 
	         FROM   (SELECT RANK() 
	                          OVER( 
	                            PARTITION BY WLOBSCD 
	                            ORDER BY WLOBSCD, WMCYMD DESC) AS RN /* 순번 */, 
	                        WLOBSCD                            AS PT_NO 
	                        /* 관측소코드 */, 
	                        OBSNM                              AS PT_NM 
	                        /* 관측소명 */, 
	                        WMCYMD /* 관측일자 */, 
	                        'WL'                               AS ITEM_NAME, 
	                        WL                                 AS ITEM_VALUE 
	                /* 수위(cm) */ 
	                 FROM   (SELECT TO_CHAR(A.YMDH, 'YYYY.MM.DD') AS WMCYMD, 
	                                A.WLOBSCD, 
	                                OBSNM, 
	                                MAX(ADM_CD)                   ADM_CD, 
	                                ROUND(AVG(WL) / 1, 2)         WL 
	                         FROM   WLDY A, 
	                                WLOBSIF D 
	                         WHERE  A.WLOBSCD = D.WLOBSCD
	                         <if test="defaultChart != null and defaultChart == 0">
	         						AND  <![CDATA[ SUBSTR(TO_CHAR(A.YMDH , 'YYYYMMDD'), 1, 6) >= #{preFullDate} ]]>
	         						AND  <![CDATA[ SUBSTR(TO_CHAR(A.YMDH , 'YYYYMMDD'), 1, 6) <= #{nextFullDate} ]]>
	         				 </if>  
	                                AND A.WLOBSCD = #{recordId} 
	                                AND WL IS NOT NULL 
	                         GROUP  BY TO_CHAR(A.YMDH, 'YYYY.MM.DD'), 
	                                   A.WLOBSCD, 
	                                   OBSNM) A, 
	                        KESTI_WATER_ALL_MAP B, 
	                        COM_DISTRICT_RAW C 
	                 WHERE  A.ADM_CD = B.ADM_CD 
	                        AND A.ADM_CD = C.ADM_CD) 
	         <if test="defaultChart != null and defaultChart == 1">
	         	WHERE  <![CDATA[ RN <= 10 ]]>
	         </if> 
	         ORDER  BY PT_NO, 
	                   WMCYMD ASC) SELECT * 
	FROM   (SELECT * 
	        FROM   TMP_TBL 
	        ORDER  BY WMCYMD) 
	UNION ALL 
	SELECT 999 AS RN, 
	       '', 
	       '', 
	       '', 
	       '', 
	       NVL(MAX(ITEM_VALUE), 0) + NVL(MAX(ITEM_VALUE), 0) / 10 
	FROM   TMP_TBL 
	</select>
	
	<select id="getRWMDTSelectD002" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL  /* getRWMDTSelectD002 */
         AS (SELECT * 
             FROM   (SELECT RANK() 
                              OVER( 
                                PARTITION BY RFOBSCD 
                                ORDER BY RFOBSCD, YMD DESC) AS RN 
                            /* 순번 참고용 */, 
                            RFOBSCD                         AS PT_NO 
                            /* 관측소코드 */, 
                            OBSNM                           AS PT_NM 
                            /* 관측소명 */, 
                            YMD                             AS WMCYMD 
                            /* 관측일자*/, 
                            'RF'                            AS ITEM_NAME, 
                            RF                              AS ITEM_VALUE 
                    /* 우량자료(mm) */ 
                     FROM   (SELECT SUBSTR(YMD, 1, 4) 
                                    ||'.' 
                                    ||SUBSTR(YMD, 5, 2) 
                                    ||'.' 
                                    ||SUBSTR(YMD, 7, 2)   AS YMD, 
                                    A.RFOBSCD, 
                                    OBSNM, 
                                    MAX(ADM_CD)           ADM_CD, 
                                    ROUND(SUM(RF) / 1, 3) RF 
                             FROM   RFDY A, 
                                    RFOBSIF D 
                             WHERE  A.RFOBSCD = D.RFOBSCD    
	                         <if test="defaultChart != null and defaultChart == 0">
	         						AND SUBSTR(YMD, 1, 6) BETWEEN #{preFullDate} AND #{nextFullDate} 
	         				 </if>       
	                                AND A.RFOBSCD = #{recordId} 
	                                AND RF IS NOT NULL 
                             GROUP  BY SUBSTR(YMD, 1, 4) 
                                    ||'.' 
                                    ||SUBSTR(YMD, 5, 2) 
                                    ||'.' 
                                    ||SUBSTR(YMD, 7, 2), 
                                       A.RFOBSCD, 
                                       D.OBSNM 
                             ORDER  BY YMD, 
                                       A .RFOBSCD, 
                                       D.OBSNM) A, 
                            KESTI_WATER_ALL_MAP B, 
                            COM_DISTRICT_RAW C 
                     WHERE  A.ADM_CD = B.ADM_CD 
                            AND A.ADM_CD = C.ADM_CD) 
                 <if test="defaultChart != null and defaultChart == 1">
                 	WHERE  RN <![CDATA[ <= ]]> 10
                 </if>
             ORDER  BY PT_NO, 
                       WMCYMD ASC) SELECT * 
    FROM   (SELECT * 
            FROM   TMP_TBL 
            ORDER  BY WMCYMD) 
    UNION ALL 
    SELECT 999 AS RN, 
           '', 
           '', 
           '', 
           '', 
           MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
    FROM   TMP_TBL
	</select>
	
	<select id="getRWMDTSelectD003" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectD003 */
	     AS (SELECT * 
	         FROM   (SELECT RANK() 
	                          OVER( 
	                            PARTITION BY WLOBSCD 
	                            ORDER BY WLOBSCD, WMCYMD DESC) AS RN,/* 순번 */ 
	                        WLOBSCD                            AS PT_NO, 
	                        /* 관측소코드 */ 
	                        OBSNM                              AS PT_NM, 
	                        /* 관측소명 */ 
	                        WMCYMD,/* 관측일자 */ 
	                        'FW'                               AS ITEM_NAME, 
	                        FW                                 AS ITEM_VALUE 
	                /* 유량(CMS) */ 
	                 FROM   (SELECT TO_CHAR(YMDH, 'YYYY.MM.DD') WMCYMD, 
	                                A.WLOBSCD, 
	                                OBSNM, 
	                                MAX(ADM_CD)                 ADM_CD, 
	                                ROUND(AVG(FW) / 1, 4)       FW 
	                         FROM   FWDY A, 
	                                FWOBSIF D 
	                         WHERE  A.WLOBSCD = D.FWOBSCD
	                         
	                         <if test="defaultChart != null and defaultChart == 0">
	         						AND  <![CDATA[ SUBSTR(TO_CHAR(A.YMDH , 'YYYYMMDD'), 1, 6) >= #{preFullDate} ]]>
	         						AND  <![CDATA[ SUBSTR(TO_CHAR(A.YMDH , 'YYYYMMDD'), 1, 6) <= #{nextFullDate} ]]>
	         				 </if>
	         				   
	                                AND A.WLOBSCD = #{recordId} 
	                                AND FW IS NOT NULL 
	                         GROUP  BY TO_CHAR(YMDH, 'YYYY.MM.DD'), 
	                                   A.WLOBSCD, 
	                                   OBSNM) A, 
	                        KESTI_WATER_ALL_MAP B, 
	                        COM_DISTRICT_RAW C 
	                 WHERE  A.ADM_CD = B.ADM_CD 
	                        AND A.ADM_CD = C.ADM_CD) 
			<if test="defaultChart != null and defaultChart == 1">
	         	WHERE  <![CDATA[ RN <= 10 ]]>
	        </if> 
	         ORDER  BY PT_NO, 
	                   WMCYMD ASC) SELECT * 
	FROM   (SELECT * 
	        FROM   TMP_TBL 
	        ORDER  BY WMCYMD) 
	UNION ALL 
	SELECT 99999 AS RN, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL 
	</select>
	
	<select id="getRWMDTSelectD004" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectD004 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY A.DMOBSCD, ITEM_NAME 
	                    ORDER BY A.DMOBSCD, YMD DESC) AS RN, 
	                OBSNM                             AS PT_NM, 
	                A.DMOBSCD                         PT_NO, 
	                SUBSTR(YMD, 1, 4) 
	                ||'.' 
	                ||SUBSTR(YMD, 5, 2) 
	                ||'.' 
	                ||SUBSTR(YMD, 7, 2)               AS WMCYMD, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT DMOBSCD, 
	                        YMD, 
	                        TRIM('SWL ')           AS ITEM_NAME, 
	                        ROUND(AVG(SWL) / 1, 3) AS ITEM_VALUE 
	                 FROM   DMDY 
	                 GROUP  BY DMOBSCD, 
	                           YMD 
	                 UNION ALL 
	                 SELECT DMOBSCD, 
	                        YMD, 
	                        TRIM('INF ')           AS ITEM_NAME, 
	                        ROUND(AVG(INF) / 1, 3) AS ITEM_VALUE 
	                 FROM   DMDY 
	                 GROUP  BY DMOBSCD, 
	                           YMD 
	                 UNION ALL 
	                 SELECT DMOBSCD, 
	                        YMD, 
	                        TRIM('OTF ')           AS ITEM_NAME, 
	                        ROUND(AVG(OTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   DMDY 
	                 GROUP  BY DMOBSCD, 
	                           YMD 
	                 UNION ALL 
	                 SELECT DMOBSCD, 
	                        YMD, 
	                        TRIM('SFW ')           AS ITEM_NAME, 
	                        ROUND(AVG(SFW) / 1, 3) AS ITEM_VALUE 
	                 FROM   DMDY 
	                 GROUP  BY DMOBSCD, 
	                           YMD 
	                 UNION ALL 
	                 SELECT DMOBSCD, 
	                        YMD, 
	                        TRIM('ECPC')            AS ITEM_NAME, 
	                        ROUND(AVG(ECPC) / 1, 3) AS ITEM_VALUE 
	                 FROM   DMDY 
	                 GROUP  BY DMOBSCD, 
	                           YMD) A, 
	                DMOBSIF B 
	         WHERE  A.DMOBSCD = B.DMOBSCD
					<if test="defaultChart != null and defaultChart == 0">             	
		             	AND <![CDATA[ SUBSTR(A.YMD, 1, 6) >= #{preFullDate} ]]>
					    AND <![CDATA[ SUBSTR(A.YMD, 1, 6) <= #{nextFullDate} ]]>
	                </if>
	                AND A.DMOBSCD = #{recordId} 
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY A.DMOBSCD, 
	                   WMCYMD ASC) SELECT * 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1">
	         	WHERE  <![CDATA[ RN <= 10 ]]>
	</if> 
	UNION ALL 
	SELECT 999, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL 
	<if test="defaultChart != null and defaultChart == 1">
	         	WHERE  <![CDATA[ RN <= 10 ]]>
	</if> 
	</select>
	
	<select id="getRWMDTSelectD005" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectD005 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY STNID||ITEM_NAME 
	                    ORDER BY STNID, WMCYMD DESC) AS RN /* 순번 */, 
	                STNID                            AS PT_NO, 
	                OBSNM                            AS PT_NM, 
	                WMCYMD, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT STNID, 
	                        SUBSTR(TM, 1, 8)       AS WMCYMD, 
	                        'WD'                   AS ITEM_NAME, 
	                        ROUND(AVG(WD / 10), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)       AS WMCYMD, 
	                        'WS'                   AS ITEM_NAME, 
	                        ROUND(AVG(WS / 10), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)       AS WMCYMD, 
	                        'TA'                   AS ITEM_NAME, 
	                        ROUND(AVG(TA / 10), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)  AS WMCYMD, 
	                        'HM'              AS ITEM_NAME, 
	                        ROUND(AVG(HM), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)  AS WMCYMD, 
	                        'PA'              AS ITEM_NAME, 
	                        ROUND(AVG(PA), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)  AS WMCYMD, 
	                        'PS'              AS ITEM_NAME, 
	                        ROUND(AVG(PS), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)    AS WMCYMD, 
	                        'RNYN'              AS ITEM_NAME, 
	                        ROUND(AVG(RNYN), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)          AS WMCYMD, 
	                        'RN1HR'                   AS ITEM_NAME, 
	                        ROUND(AVG(RN1HR / 10), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8) 
	                 UNION ALL 
	                 SELECT STNID, 
	                        SUBSTR(TM, 1, 8)          AS WMCYMD, 
	                        'RNDAY'                   AS ITEM_NAME, 
	                        ROUND(AVG(RNDAY / 10), 2) AS ITEM_VALUE 
	                 FROM   WTAWSMST 
	                 GROUP  BY STNID, 
	                           SUBSTR(TM, 1, 8)) A, 
	                WTOBSIF B 
	         WHERE  A.STNID = B.WTOBSCD 
	                AND OBSTCD = '2' 
	                AND A.STNID = #{recordId}
	                <if test="defaultChart != null and defaultChart == 1">
						AND SUBSTR(WMCYMD, 1, 6) BETWEEN '201410' AND '201510'
					</if>
					<if test="defaultChart != null and defaultChart == 0">
		 				AND SUBSTR(WMCYMD, 1, 6) BETWEEN #{preFullDate} AND #{nextFullDate}
					</if>	
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY WMCYMD ASC) SELECT * 
	FROM   (SELECT * 
	        FROM   TMP_TBL 
	        <if test="defaultChart != null and defaultChart == 1">
	        	WHERE  <![CDATA[ RN <= 10 ]]>
	        </if>
            ) 
	UNION ALL 
	SELECT 9999 AS RN, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL 
	<if test="defaultChart != null and defaultChart == 1">
		WHERE  <![CDATA[ RN <= 10 ]]>
	</if>
	</select>
	
	<select id="getRWMDTSelectD006" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectD006 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY OBSNMENG||ITEM_NAME 
	                    ORDER BY OBSNMENG, TM DESC) AS RN, 
	                TM                              AS WMCYMD, 
	                E.OBSNMENG                      AS PT_NO, 
	                STN_NM                          AS PT_NM, 
	                ITEM_NAME, 
	                MAX(ITEM_VALUE)                 AS ITEM_VALUE 
	         FROM   (SELECT * 
	                 FROM   (SELECT STN_ID, 
	                                TM, 
	                                'RND'  AS ITEM_NAME, 
	                                RN_DAY AS ITEM_VALUE 
	                         FROM   RNDY 
	                         UNION ALL 
	                         SELECT STN_ID, 
	                                TM, 
	                                'TA' AS ITEM_NAME, 
	                                TA   AS ITEM_VALUE 
	                         FROM   RNDY 
	                         UNION ALL 
	                         SELECT STN_ID, 
	                                TM, 
	                                'SIDAY' AS ITEM_NAME, 
	                                SI_DAY  AS ITEM_VALUE 
	                         FROM   RNDY)) A, 
	                KESTI_RNDY_ST D, 
	                WTOBSIF E 
	         WHERE  A.STN_ID = D.STN_ID 
	                AND A.STN_ID = E.OBSNMENG 
					<if test="defaultChart != null and defaultChart == 1">
						AND SUBSTR(A.TM, 1, 6) BETWEEN '201410' AND '201510'
					</if>
					<if test="defaultChart != null and defaultChart == 0">
						AND SUBSTR(A.TM, 1, 6) BETWEEN #{preFullDate} AND #{nextFullDate}
		 			</if>
	                AND D.STN_ID = #{recordId} 
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         GROUP  BY TM, 
	                   E.OBSNMENG, 
	                   STN_NM, 
	                   ITEM_NAME 
	         ORDER  BY PT_NO, 
	                   WMCYMD ASC) SELECT * 
	FROM   (SELECT * 
	        FROM   TMP_TBL
	        <if test="defaultChart != null and defaultChart == 1"> 
	        	WHERE  <![CDATA[ RN <= 10 ]]>
	        </if>
	        ) 
	UNION ALL 
	SELECT 999 AS RN, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]>
	</if> 
	</select>
	
	<select id="getRWMDTSelectD007" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectD007 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY A.BOOBSCD, ITEM_NAME 
	                    ORDER BY A.BOOBSCD, WMCYMD DESC, WMCYMD_2 DESC) 
	                   AS RN /* 순번 */, 
	                A.BOOBSCD 
	                   AS PT_NO /* 관측소코드 */, 
	                OBSNM 
	                   AS PT_NM /* 관측소명 */, 
	                TO_CHAR(TO_DATE(WMCYMD 
	                                ||WMCYMD_2, 'YYYYMMDD HH24:MI'), 
	                'YYYY.MM.DD HH24:MI' 
	                ) 
	                   AS WMCYMD /* 관측일자 */, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)    AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)    AS WMCYMD_2, 
	                        TRIM('SWL   ')         AS ITEM_NAME, 
	                        ROUND(AVG(SWL) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)    AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)    AS WMCYMD_2, 
	                        TRIM('OWL   ')         AS ITEM_NAME, 
	                        ROUND(AVG(OWL) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)    AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)    AS WMCYMD_2, 
	                        TRIM('SFW   ')         AS ITEM_NAME, 
	                        ROUND(AVG(SFW) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)     AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)     AS WMCYMD_2, 
	                        TRIM('ECPC  ')          AS ITEM_NAME, 
	                        ROUND(AVG(ECPC) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)    AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)    AS WMCYMD_2, 
	                        TRIM('INF   ')         AS ITEM_NAME, 
	                        ROUND(AVG(INF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)       AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)       AS WMCYMD_2, 
	                        TRIM('TOTOTF')            AS ITEM_NAME, 
	                        ROUND(AVG(TOTOTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)      AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)      AS WMCYMD_2, 
	                        TRIM('EGOTF ')           AS ITEM_NAME, 
	                        ROUND(AVG(EGOTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)      AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)      AS WMCYMD_2, 
	                        TRIM('GTOTF ')           AS ITEM_NAME, 
	                        ROUND(AVG(GTOTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)      AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)      AS WMCYMD_2, 
	                        TRIM('CBOTF ')           AS ITEM_NAME, 
	                        ROUND(AVG(CBOTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)      AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)      AS WMCYMD_2, 
	                        TRIM('FWOTF ')           AS ITEM_NAME, 
	                        ROUND(AVG(FWOTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6) 
	                 UNION ALL 
	                 SELECT BOOBSCD, 
	                        SUBSTR(YMDHM, 1, 6)       AS WMCYMD, 
	                        SUBSTR(YMDHM, 7, 6)       AS WMCYMD_2, 
	                        TRIM('ETCOTF')            AS ITEM_NAME, 
	                        ROUND(AVG(ETCOTF) / 1, 3) AS ITEM_VALUE 
	                 FROM   BOMST 
	                 GROUP  BY BOOBSCD, 
	                           SUBSTR(YMDHM, 1, 6), 
	                           SUBSTR(YMDHM, 7, 6)) A, 
	                BOOBSIF B 
	         WHERE  A.BOOBSCD = B.BOOBSCD
	    			<if test="defaultChart != null and defaultChart == 0">
						AND <![CDATA[ WMCYMD >= #{preFullDate} ]]>
						AND <![CDATA[ WMCYMD <= #{nextFullDate} ]]>
					</if>
	                AND A.BOOBSCD = #{recordId} 
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY PT_NO, 
	                   A.WMCYMD ASC) SELECT * 
	FROM   (SELECT * 
	        FROM   TMP_TBL
	        <if test="defaultChart != null and defaultChart == 1"> 
	        	WHERE  <![CDATA[ RN <= 10 ]]> 
	        </if>
	        ORDER  BY WMCYMD) 
	UNION ALL 
	SELECT 999, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if>
	</select>
	
	<select id="getRWMDTSelectF_1" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectF_1 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY A.FACI_CD, A.DISCHARGE_NUM, ITEM_NAME 
	                    ORDER BY A.FACI_CD, A.DISCHARGE_NUM, A.WORK_DT DESC) AS RN, 
	                A.FACI_CD                                                AS 
	                PT_NO, 
	                FACI_NM                                                  AS 
	                PT_NM 
	                   /* 처리시설명 */, 
	                REPLACE(A.WORK_DT, '-', '.')                             AS 
	                WMCYMD 
	                   /* 운영일자 */, 
	                '방류구번호 : ' 
	                ||A.DISCHARGE_NUM                                        AS 
	                   DISCHARGE_NUM /* 방류구번호 */, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('AMT_PHYS    ') AS ITEM_NAME, 
	                        DISCHARGE_AMT_PHYS   AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('AMT_BIO     ') AS ITEM_NAME, 
	                        DISCHARGE_AMT_BIO    AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('AMT_HIGHTEC ')  AS ITEM_NAME, 
	                        DISCHARGE_AMT_HIGHTEC AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('ITEM_BOD    ') AS ITEM_NAME, 
	                        BOD                  AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('ITEM_COD    ') AS ITEM_NAME, 
	                        COD                  AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('ITEM_SS     ') AS ITEM_NAME, 
	                        SS                   AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('ITEM_TN     ') AS ITEM_NAME, 
	                        TN                   AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('ITEM_TP     ') AS ITEM_NAME, 
	                        TP                   AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_NM, 
	                        FACI_CD, 
	                        WORK_DT, 
	                        DISCHARGE_NUM, 
	                        TRIM('ITEM_COLI   ') AS ITEM_NAME, 
	                        COLI                 AS ITEM_VALUE 
	                 FROM   VPLA_FACI_OUT_TOTAL) A, 
	                (SELECT FACI_CD, 
	                        WORK_DT, 
	                        MAX(DISCHARGE_NUM) AS DISCHARGE_NUM 
	                 FROM   VPLA_FACI_OUT_TOTAL 
	                 GROUP  BY FACI_CD, 
	                           WORK_DT) B 
	         WHERE  A.FACI_CD = B.FACI_CD 
	                AND A.WORK_DT = B.WORK_DT 
	                AND A.DISCHARGE_NUM IN ( 1, NULL ) 
	                AND A.DISCHARGE_NUM = B.DISCHARGE_NUM 
	                AND A.FACI_CD = #{recordId}
					<if test="defaultChart != null and defaultChart == 0">                
	                	AND SUBSTR(A.WORK_DT, 1, 4)||SUBSTR(A.WORK_DT, 6, 2) BETWEEN #{preFullDate} AND #{nextFullDate}
	                </if>
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY FACI_NM, 
	                   DISCHARGE_NUM, 
	                   WMCYMD ASC) SELECT * 
	FROM   (SELECT * 
	        FROM   TMP_TBL 
	        ORDER  BY WMCYMD) 
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]>
	</if> 
	UNION ALL 
	SELECT 999 AS RN, 
	       '', 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if>
	</select>
	
	<select id="getRWMDTSelectF_2" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectF_2 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY A.FACI_CD, ITEM_NAME 
	                    ORDER BY A.WORK_DT DESC) AS RN /* 순번 참고용 */, 
	                FACI_NM                      AS PT_NM /* 처리시설명*/, 
	                REPLACE(A.WORK_DT, '-', '.') AS WMCYMD /* 운영일자*/, 
	                '유입원 : ' 
	                ||A.IN_PL_TYPE               AS IN_PL_TYPE /* 유입원 */, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_AMT' AS ITEM_NAME, 
	                        AMT        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_BOD' AS ITEM_NAME, 
	                        BOD        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_COD' AS ITEM_NAME, 
	                        COD        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_SS' AS ITEM_NAME, 
	                        SS        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_TN' AS ITEM_NAME, 
	                        TN        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_TP' AS ITEM_NAME, 
	                        TP        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        IN_PL_TYPE, 
	                        'ITEM_COLI' AS ITEM_NAME, 
	                        COLI        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER) A, 
	                (SELECT FACI_CD, 
	                        WORK_DT, 
	                        MAX(IN_PL_TYPE) AS IN_PL_TYPE 
	                 FROM   VPLA_FACI_DIRECT_TRANSFER 
	                 GROUP  BY FACI_CD, 
	                           WORK_DT) B 
	         WHERE  A.FACI_CD = B .FACI_CD 
	                AND A.WORK_DT = B.WORK_DT 
	                AND A.IN_PL_TYPE = B.IN_PL_TYPE 
	                AND A.FACI_CD = #{recordId}
	                <if test="defaultChart != null and defaultChart == 0"> 
	                	AND SUBSTR(A.WORK_DT, 1, 4) ||SUBSTR(A.WORK_DT, 6, 2) BETWEEN #{preFullDate} AND #{nextFullDate}
	                </if> 
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY FACI_NM, 
	                   A.WORK_DT ASC, 
	                   IN_PL_TYPE) SELECT * 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if> 
	UNION ALL 
	SELECT 999, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if> 
	</select>

	<select id="getRWMDTSelectF_3" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectF_3 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY A.FACI_CD, A.PIPE_NUM, ITEM_NAME 
	                    ORDER BY A.FACI_CD, A.PIPE_NUM, A.WORK_DT DESC) AS RN, 
	                FACI_NM                                             AS PT_NM 
	                   /* 처리시설명 */, 
	                REPLACE(A.WORK_DT, '-', '.')                        AS WMCYMD 
	                   /* 운영일자 */, 
	                '유입구번호 : ' 
	                ||A.PIPE_NUM                                        AS PIPE_NUM 
	                   /* 유입구번호 */, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_AMT ') AS ITEM_NAME, 
	                        TO_NUMBER(AMT)    AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_BOD ') AS ITEM_NAME, 
	                        TO_NUMBER(BOD)    AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_COD ') AS ITEM_NAME, 
	                        TO_NUMBER(COD)    AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_SS  ') AS ITEM_NAME, 
	                        TO_NUMBER(SS)     AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_TN  ') AS ITEM_NAME, 
	                        TO_NUMBER(TN)     AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_TP  ') AS ITEM_NAME, 
	                        TO_NUMBER(TP)     AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 UNION ALL 
	                 SELECT YYYY, 
	                        FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        TRIM('ITEM_COLI') AS ITEM_NAME, 
	                        TO_NUMBER(COLI)   AS ITEM_VALUE 
	                 FROM   VPLA_FACI_IN_TOTAL) A, 
	                (SELECT FACI_CD, 
	                        WORK_DT, 
	                        MIN(PIPE_NUM) AS PIPE_NUM 
	                 FROM   VPLA_FACI_IN_TOTAL 
	                 GROUP  BY FACI_CD, 
	                           WORK_DT) B 
	         WHERE  A.FACI_CD = B.FACI_CD 
	                AND A.PIPE_NUM IN ( 0, 1, NULL ) 
	                AND A.PIPE_NUM = B.PIPE_NUM 
	                AND A.WORK_DT = B.WORK_DT 
	                AND A.FACI_CD = #{recordId}
	                <if test="defaultChart != null and defaultChart == 0"> 
	                	AND SUBSTR(A.WORK_DT, 1, 4) ||SUBSTR(A.WORK_DT, 6, 2) BETWEEN #{preFullDate} AND #{nextFullDate}
	                </if> 
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY FACI_NM, 
	                   PIPE_NUM, 
	                   WMCYMD ASC) SELECT * 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if>  
	UNION ALL 
	SELECT 99999, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if>  
	</select>
	
	<select id="getRWMDTSelectF_4" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	WITH TMP_TBL /* KRF-BIZ.ChartMapper.getRWMDTSelectF_4 */
	     AS (SELECT RANK() 
	                  OVER( 
	                    PARTITION BY A.FACI_CD, A.PIPE_NUM, ITEM_NAME 
	                    ORDER BY A.FACI_CD, A.PIPE_NUM, A.WORK_DT DESC) AS RN, 
	                FACI_NM                                             AS PT_NM, 
	                REPLACE(A.WORK_DT, '-', '.')                        AS WMCYMD 
	                   /* 운영일자*/, 
	                '관거번호 : ' 
	                ||A.PIPE_NUM 
	                ||'(' 
	                ||PIPE_TYPE 
	                ||')'                                               AS PIPE_NUM 
	                   /* 관거번호(관거유형) */, 
	                ITEM_NAME, 
	                ITEM_VALUE 
	         FROM   (SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_AMT' AS ITEM_NAME, 
	                        AMT        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_BOD' AS ITEM_NAME, 
	                        BOD        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_COD' AS ITEM_NAME, 
	                        COD        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_SS' AS ITEM_NAME, 
	                        SS        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_TN' AS ITEM_NAME, 
	                        TN        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_TP' AS ITEM_NAME, 
	                        TP        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_COLI' AS ITEM_NAME, 
	                        COLI        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 UNION ALL 
	                 SELECT FACI_CD, 
	                        FACI_NM, 
	                        WORK_DT, 
	                        PIPE_NUM, 
	                        PIPE_TYPE, 
	                        'ITEM_BYPASS_AMT' AS ITEM_NAME, 
	                        BYPASS_AMT        AS ITEM_VALUE 
	                 FROM   VPLA_FACI_PIPE_TRANSFER) A, 
	                (SELECT FACI_CD, 
	                        WORK_DT, 
	                        MAX(PIPE_NUM) AS PIPE_NUM 
	                 FROM   VPLA_FACI_PIPE_TRANSFER 
	                 GROUP  BY FACI_CD, 
	                           WORK_DT) B 
	         WHERE  A.FACI_CD = B.FACI_CD 
	                AND A.WORK_DT = B.WORK_DT 
	                AND A.PIPE_NUM IN ( 0, 1, NULL ) 
	                AND A.PIPE_NUM = B. PIPE_NUM 
	                AND A.FACI_CD = #{recordId}
	                <if test="defaultChart != null and defaultChart == 0"> 
	                	AND SUBSTR(A.WORK_DT, 1, 4) ||SUBSTR(A.WORK_DT, 6, 2) BETWEEN #{preFullDate} AND #{nextFullDate}
	                </if> 
	                AND ITEM_NAME = #{selectItem} 
	                AND ITEM_VALUE IS NOT NULL 
	         ORDER  BY FACI_NM, 
	                   PIPE_NUM, 
	                   WMCYMD ASC) SELECT * 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if>  
	UNION ALL 
	SELECT 999, 
	       '', 
	       '', 
	       '', 
	       '', 
	       MAX(ITEM_VALUE) + MAX(ITEM_VALUE) / 10 
	FROM   TMP_TBL
	<if test="defaultChart != null and defaultChart == 1"> 
		WHERE  <![CDATA[ RN <= 10 ]]> 
	</if>  
	</select>
	
	<select id="getRWMDTSelectI" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
	
	/* 조류모니터링 차트쿼리*/
	WITH TEMP_TBL AS (
	SELECT ROWNUM
	            RN
	     , PT_NO
	     , PT_NM
	     , WMCYMD
	     , '${selectItem}' AS ITEM_NAME
	     , ${selectItem} AS ITEM_VALUE /* Chl-a(㎎/㎥)*/
	  FROM (
	        SELECT PT_NO
	             , PT_NM
	             , WMCYMD
	             , TRIM(ITEM_TEMP) AS ITEM_TEMP
	             , TRIM(ITEM_AVERAGE_CLOA) AS ITEM_AVERAGE_CLOA
	             , TRIM(ITEM_SURFACE_BLUE_GREEN_ALGAE) AS ITEM_SURFACE_BLUE_GREEN_ALGAE
	          FROM (
	                SELECT ARD.PT_NO        /* 지점코드   */  
	                        ,ARD.PT_NM        /* 지점명   */  
	                        ,ARD.WMYR         /* 조사년도 */ 
	                        ,ARD.WMOD         /* 조사월 */   
	                        ,WMCYMD
	                        ,DECODE(ARD.ITEM_TEMP,'',' ',ARD.ITEM_TEMP) AS ITEM_TEMP     /* 측정값(수온) */  
	                        ,DECODE(ARD.ITEM_AVERAGE_CLOA,'',' ',ARD.ITEM_AVERAGE_CLOA)     AS ITEM_AVERAGE_CLOA        /* 측정값(평균 클로로필-a)  */ 
	                        ,DECODE(ARD.ITEM_SURFACE_BLUE_GREEN_ALGAE,'',' ',ARD.ITEM_SURFACE_BLUE_GREEN_ALGAE) AS ITEM_SURFACE_BLUE_GREEN_ALGAE /* 측정값(남조류세포수) */ 
	                    FROM AG_RWMDTI_DAY_V_ALL_KRF ARD /* 보*/
	                UNION ALL
	                SELECT ARD.PT_NO        /* 지점코드   */  
	                        ,ARD.PT_NM        /* 지점명   */  
	                        ,ARD.WMYR         /* 조사년도 */ 
	                        ,ARD.WMOD         /* 조사월 */   
	                        ,WMCYMD
	                        ,DECODE(ARD.ITEM_TEMP,'',' ',ARD.ITEM_TEMP) AS ITEM_TEMP     /* 측정값(수온) */  
	                        ,DECODE(ARD.ITEM_SURFACE_CLOA,'',' ',ARD.ITEM_SURFACE_CLOA)     AS ITEM_SURFACE_CLOA        /* 측정값(클로로필-a)  */ 
	                        ,DECODE(ARD.ITEM_BLUE_GREEN_ALGAE,'',' ',ARD.ITEM_BLUE_GREEN_ALGAE) AS ITEM_BLUE_GREEN_ALGAE /* 측정값(남조류세포수) */
	                    FROM AG_RWMDTI_DAY_V_KRF ARD /* 상수원구간*/
	                UNION ALL
	                SELECT ARD.PT_NO        /* 지점코드   */  
	                        ,ARD.PT_NM        /* 지점명   */  
	                        ,ARD.WMYR         /* 조사년도 */ 
	                        ,ARD.WMOD         /* 조사월 */  
	                        ,WMCYMD
	                        ,DECODE(ARD.ITEM_TEMP,'',' ',ARD.ITEM_TEMP) AS ITEM_TEMP     /* 측정값(수온) */  
	                        ,DECODE(ARD.ITEM_AVERAGE_CLOA,'',' ',ARD.ITEM_AVERAGE_CLOA)     AS ITEM_AVERAGE_CLOA        /* 측정값(클로로필-a)  */ 
	                        ,DECODE(ARD.ITEM_AVERAGE_BLUE_GREEN_ALGAE,'',' ',ARD.ITEM_AVERAGE_BLUE_GREEN_ALGAE) AS ITEM_BLUE_GREEN_ALGAE /* 측정값(남조류세포수) */ 
	                    FROM AG_RWMDTI_DAY_V_C_KRF ARD /* 친수활동구간*/
	                )
	         WHERE PT_NO = #{recordId} /* 지점코드*/
	         <if test="defaultChart != null and defaultChart == 0">
	           AND WMYR||WMOD BETWEEN #{preFullDate} AND #{nextFullDate} /* 날짜*/
	         </if>
	         ORDER BY WMCYMD DESC
	       )
	 <if test="defaultChart != null and defaultChart == 1">
	 	WHERE ROWNUM  <![CDATA[ <= 10  ]]> /* 건수 제한*/
	 </if>
	)
	SELECT *
	  FROM (
	        SELECT Rank() OVER(partition BY PT_NO ORDER BY WMCYMD DESC) RN
	             , PT_NO
	             , PT_NM
	             , TO_CHAR(WMCYMD) AS WMCYMD
	             , TO_CHAR(ITEM_NAME) AS ITEM_NAME
	             , TO_CHAR(REPLACE(ITEM_VALUE,',','')) AS ITEM_VALUE
	          FROM TEMP_TBL
	        UNION
	        SELECT TO_NUMBER('999') AS RN
	             , '' AS PT_NO
	             , '' AS PT_NM
	             , '' AS WMCYMD
	             , '' AS ITEM_NAME
	             , TO_CHAR(MAX(TO_NUMBER(REPLACE(ITEM_VALUE,',',''))) * 1.1)
	          FROM TEMP_TBL
	       )
	 ORDER BY CASE WHEN RN = '999' THEN 0 ELSE RN END DESC
	</select>
	
	<select id="getRWMDTSelectHDate" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
		SELECT MAX (DE) AS DE
		  FROM HSPF_MODEL_RESULT
		 WHERE SPOT_CODE = #{recordId}
	</select>
	
	<select id="getRWMDTSelectH" resultType="hashmap" parameterType="com.ce.krf.biz.model.ChartVO">
		/* HSPF 차트*/
		WITH TEMP_TBL AS (
		    SELECT SPOT_CODE
		         , DE
		         , TO_CHAR(PREDICT_DT,'YYYYMMDDHH24') AS PREDICT_DT
		         , BOD, CHLA, DOC, FLUX, WTRTP, NH3, NO3, OP4
		      FROM HSPF_MODEL_RESULT
		     WHERE REPLACE(SPOT_CODE,'Reach','RCH') = #{recordId} 
		       AND REPLACE(DE,'-','') BETWEEN TO_CHAR(TO_DATE(#{hMaxDate} ,'YYYYMMDD')-2,'YYYYMMDD') AND #{hMaxDate}
		)
		SELECT REPLACE(SPOT_CODE,'Reach','RCH') as SPOT_CODE
		     , PREDICT_DT
		     , ${selectItem}_1, ${selectItem}_2, ${selectItem}_3, ${selectItem}_4
		  FROM (
		        SELECT SPOT_CODE
		             , PREDICT_DT
		             , TO_NUMBER('') AS BOD_1, BOD_2, BOD_3, BOD_4
		             , TO_NUMBER('') AS CHLA_1, CHLA_2, CHLA_3, CHLA_4
		             , TO_NUMBER('') AS DOC_1, DOC_2, DOC_3, DOC_4
		             , TO_NUMBER('') AS FLUX_1, FLUX_2, FLUX_3, FLUX_4
		             , TO_NUMBER('') AS WTRTP_1, WTRTP_2, WTRTP_3, WTRTP_4
		             , TO_NUMBER('') AS NH3_1, NH3_2, NH3_3, NH3_4
		             , TO_NUMBER('') AS NO3_1, NO3_2, NO3_3, NO3_4
		             , TO_NUMBER('') AS OP4_1, OP4_2, OP4_3, OP4_4
		          FROM (
		                SELECT A.SPOT_CODE
		                     , A.PREDICT_DT
		                     , BOD_2
		                     , BOD_3
		                     , B.BOD   AS BOD_4
		                     , CHLA_2
		                     , CHLA_3
		                     , B.CHLA  AS CHLA_4
		                     , DOC_2
		                     , DOC_3
		                     , B.DOC   AS DOC_4
		                     , FLUX_2
		                     , FLUX_3
		                     , B.FLUX  AS FLUX_4
		                     , WTRTP_2
		                     , WTRTP_3
		                     , B.WTRTP AS WTRTP_4
		                     , NH3_2
		                     , NH3_3
		                     , B.NH3   AS NH3_4
		                     , NO3_2
		                     , NO3_3
		                     , B.NO3   AS NO3_4
		                     , OP4_2
		                     , OP4_3
		                     , B.OP4   AS OP4_4
		                  FROM (
		                        SELECT A.SPOT_CODE
		                             , A.PREDICT_DT
		                             , A.BOD   AS BOD_2
		                             , B.BOD   AS BOD_3
		                             , A.CHLA  AS CHLA_2
		                             , B.CHLA  AS CHLA_3
		                             , A.DOC   AS DOC_2
		                             , B.DOC   AS DOC_3
		                             , A.FLUX  AS FLUX_2
		                             , B.FLUX  AS FLUX_3
		                             , A.WTRTP AS WTRTP_2
		                             , B.WTRTP AS WTRTP_3
		                             , A.NH3   AS NH3_2
		                             , B.NH3   AS NH3_3
		                             , A.NO3   AS NO3_2
		                             , B.NO3   AS NO3_3
		                             , A.OP4   AS OP4_2
		                             , B.OP4   AS OP4_3
		                          FROM (
		                                SELECT SPOT_CODE, DE, PREDICT_DT, BOD, CHLA, DOC, FLUX, WTRTP, NH3, NO3, OP4
		                                  FROM TEMP_TBL
		                                 WHERE REPLACE(DE,'-','') = #{hMaxDate}
		                               ) A LEFT JOIN
		                               (
		                                SELECT SPOT_CODE, DE, PREDICT_DT, BOD, CHLA, DOC, FLUX, WTRTP, NH3, NO3, OP4
		                                  FROM TEMP_TBL
		                                 WHERE REPLACE(DE,'-','') = TO_CHAR(TO_DATE(#{hMaxDate},'YYYYMMDD')-1,'YYYYMMDD') 
		                               ) B
		                            ON (A.SPOT_CODE = B.SPOT_CODE AND A.PREDICT_DT = B.PREDICT_DT)
		                       ) A LEFT JOIN
		                       (
		                        SELECT SPOT_CODE, DE, PREDICT_DT, BOD, CHLA, DOC, FLUX, WTRTP, NH3, NO3, OP4
		                          FROM TEMP_TBL
		                         WHERE REPLACE(DE,'-','') = TO_CHAR(TO_DATE(#{hMaxDate},'YYYYMMDD')-2,'YYYYMMDD') 
		                       ) B
		                    ON (A.SPOT_CODE = B.SPOT_CODE AND A.PREDICT_DT = B.PREDICT_DT)
		               )
		        UNION ALL
		         SELECT RCH_CDOE AS SPOT_CODE
		              , REPLACE(WMYMD,'-','')||WMCTM AS PREDICT_DT
		              , ITEM_BOD AS BOD_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_CLOA AS CHLA_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_DOC AS DOC_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_AMNT AS FLUX_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_TEMP AS WTRTP_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_NH3N AS NH3_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_NO3N AS NO3_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		              , ITEM_POP AS OP4_1,TO_NUMBER(''),TO_NUMBER(''),TO_NUMBER('')
		           FROM (
		                 SELECT RANK() OVER(PARTITION BY B.RCH_CDOE ORDER BY WMYMD DESC) AS RN
		                      , B.RCH_CDOE, WMYMD, WMCTM, ITEM_BOD, ITEM_CLOA, ITEM_DOC, ITEM_AMNT, ITEM_TEMP, ITEM_NH3N, ITEM_NO3N, ITEM_POP
		                   FROM (
		                         SELECT A.PT_NO
		                              , REPLACE(B.WMYMD,'.','-') AS WMYMD
		                              , CASE WHEN WMCTM IS NULL THEN '00'
		                                ELSE SUBSTR(WMCTM,1,2)
		                                END WMCTM
		                              , CASE WHEN ITEM_BOD  = '999999999' THEN 0 ELSE ITEM_BOD  END ITEM_BOD 
		                              , CASE WHEN ITEM_CLOA = '999999999' THEN 0 ELSE ITEM_CLOA END ITEM_CLOA
		                              , CASE WHEN ITEM_DOC  = '999999999' THEN 0 ELSE ITEM_DOC  END ITEM_DOC 
		                              , CASE WHEN ITEM_AMNT = '999999999' THEN 0 ELSE ITEM_AMNT END ITEM_AMNT
		                              , CASE WHEN ITEM_TEMP = '999999999' THEN 0 ELSE ITEM_TEMP END ITEM_TEMP
		                              , CASE WHEN ITEM_NH3N = '999999999' THEN 0 ELSE ITEM_NH3N END ITEM_NH3N
		                              , CASE WHEN ITEM_NO3N = '999999999' THEN 0 ELSE ITEM_NO3N END ITEM_NO3N
		                              , CASE WHEN ITEM_POP  = '999999999' THEN 0 ELSE ITEM_POP  END ITEM_POP 
		                           FROM RWMDTI_NEW A
		                              , RWMDTD B
		                         WHERE A.PT_NO = B.PT_NO
		                           AND A.WMYR = B.WMYR
		                           AND A.WMOD = B.WMOD
		                           AND A.WMWK = B.WMWK
		                           AND REPLACE(B.WMYMD,'.','') <![CDATA[  <  ]]>#{hMaxDate} 
		                           AND SUBSTR(A.PT_NO,5,1) = 'A'
		                           AND A.WMYR >= '2017'
		                       ) A
		                     , (
		                        SELECT 'RCH48' AS RCH_CDOE,'2003A12' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH49' AS RCH_CDOE,'2004A90' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH51' AS RCH_CDOE,'2001A60' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH52' AS RCH_CDOE,'2002A50' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH56' AS RCH_CDOE,'2003A20' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH61' AS RCH_CDOE,'2003A40' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH62' AS RCH_CDOE,'2003A43' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH63' AS RCH_CDOE,'2005A30' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH69' AS RCH_CDOE,'2006A20' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH74' AS RCH_CDOE,'2008A40' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH89' AS RCH_CDOE,'2009A10' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH90' AS RCH_CDOE,'2010A30' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH105' AS RCH_CDOE,'2011A19' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH130' AS RCH_CDOE,'2011A50' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH131' AS RCH_CDOE,'2011A30' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH135' AS RCH_CDOE,'2012A70' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH144' AS RCH_CDOE,'2014A20' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH145' AS RCH_CDOE,'2014A35' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH158' AS RCH_CDOE,'2013A40' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH161' AS RCH_CDOE,'2016A30' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH168' AS RCH_CDOE,'2017A20' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH169' AS RCH_CDOE,'2017A40' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH183' AS RCH_CDOE,'2020A15' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH184' AS RCH_CDOE,'2020A10' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH185' AS RCH_CDOE,'2017A60' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH186' AS RCH_CDOE,'2019A80' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH188' AS RCH_CDOE,'2020A30' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH189' AS RCH_CDOE,'2021A60' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH191' AS RCH_CDOE,'2020A40' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH193' AS RCH_CDOE,'2020A35' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH199' AS RCH_CDOE,'2020A50' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH201' AS RCH_CDOE,'2020A47' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH209' AS RCH_CDOE,'2022A10' AS PT_NO FROM DUAL UNION ALL
		                        SELECT 'RCH210' AS RCH_CDOE,'2022A25' AS PT_NO FROM DUAL
		                       ) B
		                 WHERE A.PT_NO = B.PT_NO
		               )
		          WHERE RN <![CDATA[  <=  ]]> '4'
		            AND RCH_CDOE = #{recordId} 
		       )
		 ORDER BY TO_DATE(PREDICT_DT,'YYYYMMDDHH24')
	</select>
</mapper>